
# Алгоритм Лемпеля-Зива (LZ77)

Алгоритм LZ77 был опубликован в 1977 г. Разработан математиками Якобом Зивом (Ziv) и Авраамом Лемпелом (Lempel). Одной 
из причин популярности алгоритмов LZ является их исключительная простота при высокой эффективности сжатия. 

Основная идея LZ77 состоит в том, что второе и последующие вхождения 
некоторой строки символов в сообщении заменяются ссылками на ее первое вхождение.

Такой принцип называется словарным методом сжатия.

## Описание алгоритма

* Алгоритм использует в качестве словаря строку последних закодированных(в кодере) или декодированных(в декодере) символов
* Кодер LZ77 работает с буфером, разделенным на две части:
    * уже закодированные символы
    * символы, которые предстоит закодировать
* Буфер является **скользящим окном**, через которое алгоритм работает с входной последовательностью
* Окно передвигается вперед по мере кодирования последовательности

**Воспроизводимое расширение (RE)** - строка символов максимальной длины, которая начинается в первой части буфера
и совпадает с префиксом второй части буфера. (это и есть тот самый повторяющийся фрагмент, который будет заменен ссылкой).

Максимальная длина воспроизводимого расширения равна длине второй части буфера минус 1.

### Кодовое слово

Кодовое слово LZ77 состоит из трех частей:

* **Индекс начала RE(0, если RE не найдено)**
* **Длина RE(0, если RE не найдено)**
* **Следующий символ после RE**

PS: Не найдено RE может быть в том случае, если вторая часть буфера начинается с символа, 
который не встречается в первой части буфера


## Пример

Пусть дано сообщение `синяя_синева_синеет`

Установим:
* Словарь **9** символов
* Размер буфера **6** символов

Тогда составим таблицу для кодирования:

| 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 1 | 2 | 3 | 4 | 5 | 6 | Код |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|-----|
|   |   |   |   |   |   |   |   |   | с | и | н | я | я | _ | 00с |

Мы записали в буфер начало данной строки. Учитывая [принцип кодового слова](#кодовое-слово) получили
код `00c`, так как RE не найдено.

Сдвигаем сообщение и получаем:

| 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 |  1  | 2 | 3 | 4 | 5 | 6 | Код   |
|---|---|---|---|---|---|---|---|---|-----|---|---|---|---|---|-------|
|   |   |   |   |   |   |   |   |   | `с` | и | н | я | я | _ | `00с` |
|   |   |   |   |   |   |   |   | с | `и` | н | я | я | _ | с | `00и` |

Так как не нашли RE, записываем код `00и`.

Продолжаем сдвигать сообщение и получаем:

| 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9   | 1   | 2 | 3 | 4 | 5 | 6 | Код   |
|---|---|---|---|---|---|---|---|-----|-----|---|---|---|---|---|-------|
|   |   |   |   |   |   |   |   |     | `с` | и | н | я | я | _ | `00с` |
|   |   |   |   |   |   |   |   | с   | `и` | н | я | я | _ | с | `00и` |
|   |   |   |   |   |   |   | с | и   | `н` | я | я | _ | с | и | `00н` |
|   |   |   |   |   |   | с | и | н   | `я` | я | _ | с | и | н | `00я` |
|   |   |   |   |   | с | и | н | `я` | `я` | _ | с | и | н | е | `81_` |

На этом этапе мы обнаруживаем, что последовательность `я` повторяется, поэтому записываем код:

* **Индекс начала RE** - 8 - это индекс начала последнего вхождения `я` в словаре
* **Длина RE** - 1 - это длина последовательности `я`
* **Следующий символ после RE** - `_` - это следующий символ после `я` в буфере

Получаем код `81_`


Сдвигаем сообщение на RE + 1 и получаем:

| 1 | 2 | 3 | 4   | 5   | 6   | 7 | 8 | 9   | 1   | 2   | 3   | 4 | 5 | 6 | Код   |
|---|---|---|-----|-----|-----|---|---|-----|-----|-----|-----|---|---|---|-------|
|   |   |   |     |     |     |   |   |     | `с` | и   | н   | я | я | _ | `00с` |
|   |   |   |     |     |     |   |   | с   | `и` | н   | я   | я | _ | с | `00и` |
|   |   |   |     |     |     |   | с | и   | `н` | я   | я   | _ | с | и | `00н` |
|   |   |   |     |     |     | с | и | н   | `я` | я   | _   | с | и | н | `00я` |
|   |   |   |     |     | с   | и | н | `я` | `я` | _   | с   | и | н | е | `81_` |
|   |   |   | `с` | `и` | `н` | я | я | _   | `c` | `и` | `н` | е | в | а | `33е` |

На данном этапе найдено RE `син`, поэтому записываем код:

* **Индекс начала RE** - 3 - это индекс начала последнего вхождения `син` в словаре
* **Длина RE** - 3 - это длина последовательности `син`
* **Следующий символ после RE** - `е` - это следующий символ после `син` в буфере

Получаем код `33е`. Записываем и сдвигаем на RE + 1:

Повторяем процесс до тех пор, пока буфер не окажется пустым

| 1 | 2 | 3   | 4   | 5   | 6   | 7   | 8 | 9   |     | 1   | 2   | 3   | 4   | 5   | 6 | Код   |
|---|---|-----|-----|-----|-----|-----|---|-----|-----|-----|-----|-----|-----|-----|---|-------|
|   |   |     |     |     |     |     |   |     |     | `с` | и   | н   | я   | я   | _ | `00с` |
|   |   |     |     |     |     |     |   | с   |     | `и` | н   | я   | я   | _   | с | `00и` |
|   |   |     |     |     |     |     | с | и   |     | `н` | я   | я   | _   | с   | и | `00н` |
|   |   |     |     |     |     | с   | и | н   |     | `я` | я   | _   | с   | и   | н | `00я` |
|   |   |     |     |     | с   | и   | н | `я` |     | `я` | _   | с   | и   | н   | е | `81_` |
|   |   |     | `с` | `и` | `н` | я   | я | _   |     | `c` | `и` | `н` | е   | в   | а | `33е` |
| и | н | я   | я   | _   | с   | и   | н | е   |     | в   | а   | _   | с   | и   | н | `00в` |
| н | я | я   | _   | с   | и   | н   | е | в   |     | `а` | _   | с   | и   | н   | е | `00а` |
| я | я | `_` | `с` | `и` | `н` | `е` | в | а   |     | `_` | `с` | `и` | `н` | `е` | е | `25e` |
| е | в | а   | _   | с   | и   | н   | e | e   |     | `т` |     |     |     |     |   | `00т` |

Готово, мы получили закодированное сообщение `00c 00и 00н 00я 81_ 33е 00а 25e 00т`

## Декодирование

Декодирование происходит в обратном порядке. Для этого необходимо знать размер словаря.


| Код   | Печать | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 |
|-------|:------:|---|---|---|---|---|---|---|---|---|
| `00с` |   c    |   |   |   |   |   |   |   |   | c |
| `00и` |   и    |   |   |   |   |   |   |   | с | и |
| `00н` |   н    |   |   |   |   |   |   | с | и | н |
| `00я` |   я    |   |   |   |   |   | с | и | н | я |
| `81_` |   я_   |   |   |   | с | и | н | я | я | _ |
| `33е` |  сине  | и | н | я | я | _ | с | и | н | е |
| `00в` |   в    | н | я | я | _ | с | и | н | е | в |
| `00а` |   а    | я | я | _ | с | и | н | е | в | а |
| `25e` | _синее | е | в | а | _ | с | и | н | е | е |
| `00т` |   т    | в | а | _ | с | и | н | е | е | т |

